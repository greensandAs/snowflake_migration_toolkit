USE DATABASE {{ snowflake_database }};
USE SCHEMA {{ snowflake_schema }};

-- ALTER TABLE DQ_DATASET_COLUMN
-- ADD COLUMN JUSTIFICATION_NEW ARRAY;

TRUNCATE TABLE MICROSEGMENT_PROFILER_ATTRIBUTE_SUMMARY;
TRUNCATE TABLE MICROSEGMENT_PROFILER_DATASET_SUMMARY;
TRUNCATE TABLE MICROSEGMENT_DETAILS;


DROP TABLE IF EXISTS MICROSEGMENT_PROFILER_ATTRIBUTE_SUMMARY;

CREATE OR REPLACE TABLE MICROSEGMENT_PROFILER_ATTRIBUTE_SUMMARY (
    MICROSEGMENT_PROFILER_SNAPSHOT_ID NUMBER(38, 0) NOT NULL,
    MICROSEGMENT_COLUMN_ID NUMBER(38, 0) NOT NULL,
    MICROSEGMENT_DEF_ID NUMBER(38, 0) NOT NULL,
    DATASET_ID NUMBER(38, 0) NOT NULL,
    MICROSEGMENT_ATTRIBUTE_DISTINCT_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_DISTINCT_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_IS_UNIQUE BOOLEAN,
    MICROSEGMENT_ATTRIBUTE_UNIQUE_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_UNIQUE_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_DATA_TYPE VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_IS_HASHABLE BOOLEAN,
    MICROSEGMENT_VALUE_COUNTS_NON_NULL VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_VALUE_COUNTS_SORTED VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_IS_ORDERED BOOLEAN,
    MICROSEGMENT_ATTRIBUTE_MISSING_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_TOTAL_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_MISSING_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_NON_NULL_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_MEMORY_SIZE_BYTES FLOAT,
    MICROSEGMENT_ATTRIBUTE_FIRST_FEW_ROWS VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_MAX_LENGTH FLOAT,
    MICROSEGMENT_ATTRIBUTE_AVG_LENGTH FLOAT,
    MICROSEGMENT_ATTRIBUTE_MEDIAN_LENGTH FLOAT,
    MICROSEGMENT_ATTRIBUTE_MIN_LENGTH FLOAT,
    MICROSEGMENT_ATTRIBUTE_LENGTH_DISTRIBUTION VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_HISTOGRAM_LENGTH VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_DISTINCT_CHARACTER_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_TOTAL_CHARACTER_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_CHARACTER_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_CATEGORY_ALIASES VARCHAR(16777216),
    MICROSEGMENT_BLOCK_ALIASES VARCHAR(16777216),
    MICROSEGMENT_BLOCK_ALIAS_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_BLOCK_ALIAS_COUNT FLOAT,
    MICROSEGMENT_BLOCK_ALIAS_CHARACTER_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_SCRIPT_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_SCRIPT_COUNT FLOAT,
    MICROSEGMENT_SCRIPT_CHARACTER_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_CATEGORY_ALIAS_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_CATEGORY_COUNT FLOAT,
    MICROSEGMENT_CATEGORY_ALIAS_CHARACTER_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_WORD_FREQUENCIES VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_INFERRED_DATA_TYPE VARCHAR(16777216),
    MICROSEGMENT_EXECUTION_DATE_START TIMESTAMP_NTZ(9),
    MICROSEGMENT_EXECUTION_DATE_END TIMESTAMP_NTZ(9),
    MICROSEGMENT_ATTRIBUTE_ALERT VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_NEGATIVE_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_NEGATIVE_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_INFINITE_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_ZERO_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_MEAN_VALUE FLOAT,
    MICROSEGMENT_ATTRIBUTE_STD_DEV FLOAT,
    MICROSEGMENT_ATTRIBUTE_VARIANCE_VALUE FLOAT,
    MICROSEGMENT_ATTRIBUTE_MIN_VALUE VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_MAX_VALUE VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_KURTOSIS_VALUE FLOAT,
    MICROSEGMENT_ATTRIBUTE_SKEWNESS_VALUE FLOAT,
    MICROSEGMENT_ATTRIBUTE_SUM_VALUE FLOAT,
    MICROSEGMENT_ATTRIBUTE_MEAN_ABSOLUTE_DEVIATION FLOAT,
    MICROSEGMENT_ATTRIBUTE_CHI_SQUARED_TEST VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_VALUE_RANGE VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_PERCENTILE_5 FLOAT,
    MICROSEGMENT_ATTRIBUTE_PERCENTILE_25 FLOAT,
    MICROSEGMENT_ATTRIBUTE_PERCENTILE_50 FLOAT,
    MICROSEGMENT_ATTRIBUTE_PERCENTILE_75 FLOAT,
    MICROSEGMENT_ATTRIBUTE_PERCENTILE_95 FLOAT,
    MICROSEGMENT_ATTRIBUTE_INTERQUARTILE_RANGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_COEFFICIENT_OF_VARIATION FLOAT,
    MICROSEGMENT_ATTRIBUTE_ZERO_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_INFINITE_PERCENTAGE FLOAT,
    MICROSEGMENT_ATTRIBUTE_MONOTONIC_INCREASING VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_MONOTONIC_DECREASING VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_STRICTLY_MONOTONIC_INCREASING VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_STRICTLY_MONOTONIC_DECREASING VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_MONOTONIC_TREND FLOAT,
    MICROSEGMENT_ATTRIBUTE_VALUE_HISTOGRAM VARCHAR(16777216),
    MICROSEGMENT_ATTRIBUTE_DATA_IMBALANCE FLOAT,
    MICROSEGMENT_ATTRIBUTE_INVALID_DATE_COUNT FLOAT,
    MICROSEGMENT_ATTRIBUTE_INVALID_DATES_TOTAL FLOAT,
    MICROSEGMENT_ATTRIBUTE_INVALID_DATES_PERCENTAGE FLOAT,
    MICROSEGMENT_PROFILER_EXECUTION_DATE_START TIMESTAMP_NTZ(9),
    MICROSEGMENT_PROFILER_EXECUTION_DATE_END TIMESTAMP_NTZ(9),
    CREATED_BY VARCHAR(100),
    CREATED_TIMESTAMP TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
    UPDATED_BY VARCHAR(100),
    UPDATED_TIMESTAMP TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
    CONSTRAINT PK_MICROSEGMENT_PROFILER_ATTRIBUTE_SUMMARY PRIMARY KEY (
        MICROSEGMENT_DEF_ID, DATASET_ID, MICROSEGMENT_PROFILER_SNAPSHOT_ID, MICROSEGMENT_COLUMN_ID
    )
);
