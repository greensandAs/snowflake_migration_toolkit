--- Set the context (Assuming this is run after an 'Always' script sets the default context)
CREATE DATABASE {{ snowflake_database }};

CREATE SCHEMA {{ snowflake_schema }};

USE DATABASE {{ snowflake_database }};

USE SCHEMA {{ snowflake_schema }};

---
--- TABLE 1: PROFILER_ATTRIBUTE_STATS (Column-level statistics).
---
CREATE TABLE IF NOT EXISTS {{ snowflake_database }}.{{ snowflake_schema }}.PROFILER_ATTRIBUTE_STATS (
    RUN_ID VARCHAR(16777216),
    DATASET_ID NUMBER(38, 0),
    DATASET_NAME VARCHAR(16777216),
    DATABASE_NAME VARCHAR(16777216),
    SCHEMA_NAME VARCHAR(16777216),
    TABLE_NAME VARCHAR(16777216),
    CUSTOM_SQL VARCHAR(16777216),
    COLUMN_ID NUMBER(38, 0),
    COLUMN_NAME VARCHAR(16777216),
    DATA_TYPE VARCHAR(16777216),
    COLUMN_MIN_VALUE VARCHAR(16777216),
    COLUMN_MAX_VALUE VARCHAR(16777216),
    COLUMN_MEAN_VALUE VARCHAR(16777216),
    COLUMN_STD_DEV VARCHAR(16777216),
    COLUMN_MAX_LENGTH FLOAT,
    COLUMN_MEDIAN_VALUE FLOAT,
    COLUMN_AVG_LENGTH FLOAT,
    COLUMN_MEDIAN_LENGTH FLOAT,
    COLUMN_MIN_LENGTH FLOAT,
    COLUMN_LENGTH_DISTRIBUTION VARCHAR(16777216),
    COLUMN_HISTOGRAM_LENGTH VARCHAR(16777216),
    COLUMN_IS_HASHABLE BOOLEAN,
    CHARACTER_FREQUENCY VARCHAR(16777216),
    IS_VALIDATION_SUCCESS VARCHAR(16777216),
    COLUMN_TOTAL_COUNT FLOAT,
    COLUMN_DISTINCT_COUNT FLOAT,
    COLUMN_DISTINCT_PERCENTAGE FLOAT,
    VALUE_COUNTS_WITHOUT_NAN VARCHAR(16777216),
    COLUMN_IS_UNIQUE BOOLEAN,
    COLUMN_UNIQUE_COUNT FLOAT,
    COLUMN_UNIQUE_PERCENT FLOAT,
    COLUMN_NEGATIVE_COUNT FLOAT,
    COLUMN_NEGATIVE_PERCENTAGE FLOAT,
    COLUMN_ZERO_COUNT FLOAT,
    COLUMN_ZERO_COUNT_PERCENT FLOAT,
    IS_NULL VARCHAR(16777216),
    COLUMN_MISSING_COUNT FLOAT,
    COLUMN_MISSING_PERCENTAGE FLOAT,
    OBSERVED_VALUE VARCHAR(16777216),
    REGEX VARCHAR(16777216),
    VALUE_SET VARCHAR(16777216),
    PROFILE_START_TIMESTAMP TIMESTAMP_NTZ(9),
    PROFILE_END_TIMESTAMP TIMESTAMP_NTZ(9),
    PROFILED_AT TIMESTAMP_NTZ(9),
    PATTERNS VARCHAR(16777216),
    COLUMN_NON_NULL_COUNT FLOAT,
    COLUMN_MEMORY_SIZE_BYTES FLOAT,
    COLUMN_FIRST_FEW_ROWS VARCHAR(16777216),
    COLUMN_CHI_SQUARED VARCHAR(16777216),
    COLUMN_DATA_IMBALANCE FLOAT,
    COLUMN_INFINITE_COUNT FLOAT,
    COLUMN_VARIANCE_VALUE FLOAT,
    COLUMN_KURTOSIS_VALUE FLOAT,
    COLUMN_SKEWNESS_VALUE FLOAT,
    COLUMN_SUM_VALUE FLOAT,
    COLUMN_MEAN_ABSOLUTE_DEVIATION FLOAT,
    COLUMN_VALUE_RANGE VARCHAR(16777216),
    COLUMN_PERCENTILE_5 FLOAT,
    COLUMN_PERCENTILE_25 FLOAT,
    COLUMN_PERCENTILE_50 FLOAT,
    COLUMN_PERCENTILE_75 FLOAT,
    COLUMN_PERCENTILE_95 FLOAT,
    COLUMN_INTERQUARTILE_RANGE FLOAT,
    COLUMN_COEFFICIENT_OF_VARIATION FLOAT,
    COLUMN_ZERO_PERCENTAGE FLOAT,
    COLUMN_INFINITE_PERCENTAGE FLOAT,
    COLUMN_MONOTONIC_INCREASING VARCHAR(16777216),
    COLUMN_MONOTONIC_DECREASING VARCHAR(16777216),
    COLUMN_STRICTLY_MONOTONIC_INCREASING VARCHAR(16777216),
    COLUMN_STRICTLY_MONOTONIC_DECREASING VARCHAR(16777216),
    COLUMN_MONOTONIC_TREND FLOAT,
    COLUMN_VALUE_HISTOGRAM VARCHAR(16777216),
    COLUMN_INVALID_DATE_COUNT FLOAT,
    COLUMN_INVALID_DATES_TOTAL FLOAT,
    COLUMN_INVALID_DATES_PERCENTAGE FLOAT,
    COLUMN_ALERT VARCHAR(16777216),
    COLUMN_MIN_VALUE_JA VARCHAR(16777216),
    COLUMN_MAX_VALUE_JA VARCHAR(16777216),
    COLUMN_MEAN_VALUE_JA VARCHAR(16777216),
    COLUMN_SUM_VALUE_JA VARCHAR(16777216),
    COLUMN_MEDIAN_VALUE_JA VARCHAR(16777216),
    COLUMN_PERCENTILE_5_JA VARCHAR(16777216),
    COLUMN_PERCENTILE_25_JA VARCHAR(16777216),
    COLUMN_PERCENTILE_50_JA VARCHAR(16777216),
    COLUMN_PERCENTILE_75_JA VARCHAR(16777216),
    COLUMN_PERCENTILE_95_JA VARCHAR(16777216),
    COLUMN_TOTAL_COUNT_JA VARCHAR(16777216),
    COLUMN_NON_NULL_COUNT_JA VARCHAR(16777216),
    COLUMN_MISSING_COUNT_JA VARCHAR(16777216),
    COLUMN_DISTINCT_COUNT_JA VARCHAR(16777216),
    COLUMN_UNIQUE_COUNT_JA VARCHAR(16777216),
    COLUMN_NEGATIVE_COUNT_JA VARCHAR(16777216),
    COLUMN_ZERO_COUNT_JA VARCHAR(16777216),
    COLUMN_STD_DEV_JA VARCHAR(16777216),
    COLUMN_AVG_LENGTH_JA VARCHAR(16777216),
    COLUMN_MAX_LENGTH_JA VARCHAR(16777216),
    COLUMN_MEDIAN_LENGTH_JA VARCHAR(16777216),
    COLUMN_MIN_LENGTH_JA VARCHAR(16777216),
    COLUMN_INFINITE_COUNT_JA VARCHAR(16777216),
    COLUMN_VARIANCE_VALUE_JA VARCHAR(16777216),
    COLUMN_KURTOSIS_VALUE_JA VARCHAR(16777216),
    COLUMN_SKEWNESS_VALUE_JA VARCHAR(16777216),
    COLUMN_MEAN_ABSOLUTE_DEVIATION_JA VARCHAR(16777216),
    COLUMN_INTERQUARTILE_RANGE_JA VARCHAR(16777216),
    COLUMN_COEFFICIENT_OF_VARIATION_JA VARCHAR(16777216),
    COLUMN_MONOTONIC_TREND_JA VARCHAR(16777216),
    COLUMN_INVALID_DATE_COUNT_JA VARCHAR(16777216),
    COLUMN_INVALID_DATES_TOTAL_JA VARCHAR(16777216),
    COLUMN_DATA_IMBALANCE_JA VARCHAR(16777216),
    COLUMN_MEMORY_SIZE_BYTES_JA VARCHAR(16777216),
    USE_APPROX BOOLEAN,
    COLUMN_INFERRED_DATA_TYPE VARCHAR(16777216)
);

---
--- TABLE 2: PROFILER_DATASET_STATS (Dataset-level statistics)
---
CREATE TABLE IF NOT EXISTS {{ snowflake_database }}.{{ snowflake_schema }}.PROFILER_DATASET_STATS (
    RUN_ID VARCHAR(16777216),
    DATASET_ID NUMBER(38, 0),
    DATABASE_NAME VARCHAR(16777216),
    SCHEMA_NAME VARCHAR(16777216),
    TABLE_NAME VARCHAR(16777216),
    CUSTOM_SQL VARCHAR(16777216),
    DATASET_NAME VARCHAR(16777216),
    TOTAL_ROWS NUMBER(38, 0),
    TOTAL_COLUMNS NUMBER(38, 0),
    NULL_COUNT NUMBER(38, 0),
    NULL_PERCENT FLOAT,
    DUPLICATE_COUNT NUMBER(38, 0),
    CORRELATION_MATRIX VARCHAR(16777216),
    MISSING_VALUES_COUNT NUMBER(38, 0),
    UNIQUE_VALUES_COUNT NUMBER(38, 0),
    PROFILE_START_TIMESTAMP TIMESTAMP_NTZ(9),
    PROFILE_END_TIMESTAMP TIMESTAMP_NTZ(9),
    PROFILED_AT TIMESTAMP_NTZ(9),
    TOTAL_ROWS_JA VARCHAR(16777216),
    TOTAL_COLUMNS_JA VARCHAR(16777216),
    MISSING_VALUES_COUNT_JA VARCHAR(16777216),
    UNIQUE_VALUES_COUNT_JA VARCHAR(16777216),
    NULL_COUNT_JA VARCHAR(16777216),
    DUPLICATE_COUNT_JA VARCHAR(16777216),
    NULL_PERCENT_JA VARCHAR(16777216),
    USE_APPROX BOOLEAN

);

----
--- TABLE 3: PROFILER_AUDIT_LOGS (Log table for tracking profiler runs)
---
CREATE TABLE IF NOT EXISTS {{ snowflake_database }}.{{ snowflake_schema }}.PROFILER_AUDIT_LOGS (
    RUN_ID VARCHAR(16777216),
    DATASET_ID NUMBER(38, 0),
    DATASET_NAME VARCHAR(16777216),
    DATABASE_NAME VARCHAR(16777216),
    SCHEMA_NAME VARCHAR(16777216),
    TABLE_NAME VARCHAR(16777216),
    CUSTOM_SQL_QUERY VARCHAR(16777216),
    STEP VARCHAR(16777216),
    STATUS VARCHAR(16777216),
    MESSAGE VARCHAR(16777216),
    LOG_TIMESTAMP TIMESTAMP_NTZ(9)
);
